<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Access Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
    }

    form {
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #666;
    }

    input,
    select {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    button:hover {
      background-color: #45a049;
    }

    .time-input-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .time-input-container input[type="time"] {
      width: 70%;
    }

    .time-input-container input[type="number"] {
      width: 25%;
    }

    .qr-checkbox-container {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .qr-checkbox-container input[type="checkbox"] {
      width: auto;
      margin-right: 10px;
    }

    .qr-checkbox-container label {
      margin-bottom: 0;
      font-size: 14px;
      color: #333;
    }

    /* Custom checkbox styling */
    .custom-checkbox {
      display: inline-block;
      position: relative;
      padding-left: 25px;
      margin-bottom: 12px;
      cursor: pointer;
      font-size: 14px;
      user-select: none;
    }

    .custom-checkbox input {
      position: absolute;
      opacity: 0;
      cursor: pointer;
      height: 0;
      width: 0;
    }

    .checkmark {
      position: absolute;
      top: 0;
      left: 0;
      height: 18px;
      width: 18px;
      background-color: #eee;
      border-radius: 3px;
    }

    .custom-checkbox:hover input~.checkmark {
      background-color: #ccc;
    }

    .custom-checkbox input:checked~.checkmark {
      background-color: #4CAF50;
    }

    .checkmark:after {
      content: "";
      position: absolute;
      display: none;
    }

    .custom-checkbox input:checked~.checkmark:after {
      display: block;
    }

    .custom-checkbox .checkmark:after {
      left: 6px;
      top: 2px;
      width: 5px;
      height: 10px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }
  </style>
</head>

<body>
  <form id="accessForm">
    <h1>Access Form</h1>
    <label for="iin">IIN:</label>
    <input type="text" id="iin" name="iin" required>

    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required>

    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required>

    <label for="region">Region:</label>
    <select id="region" name="region" required>
      <option value="">Select Region</option>
    </select>

    <label for="city">City:</label>
    <select id="city" name="city" required>
      <option value="">Select City</option>
    </select>

    <label for="time">Time:</label>
    <div class="time-input-container">
      <input type="time" id="time" name="time" value="06:59:59" required step="1">
      <input type="number" id="millisecond" name="millisecond" value="500" required min="0" max="999" placeholder="ms">
    </div>

    <div class="qr-checkbox-container">
      <label class="custom-checkbox">
        Enable QR Code
        <input type="checkbox" id="qr_enabled" name="qr_enabled">
        <span class="checkmark"></span>
      </label>
    </div>

    <button type="submit" id="submit_button">Submit</button>
  </form>

  <script>
    const regionData = {
      "l": [
        // ... (region data remains unchanged)
      ]
    };

    const regionSelect = document.getElementById('region');
    const citySelect = document.getElementById('city');

    // Populate region select
    regionData.l.forEach(region => {
      const option = document.createElement('option');
      option.value = region.Name;
      option.textContent = region.Name;
      regionSelect.appendChild(option);
    });

    // Update city select based on selected region
    regionSelect.addEventListener('change', (event) => {
      const selectedRegion = event.target.value;
      citySelect.innerHTML = '<option value="">Select City</option>';

      const region = regionData.l.find(r => r.Name === selectedRegion);
      if (region) {
        region.cities.forEach(city => {
          const option = document.createElement('option');
          option.value = city.Url;
          option.textContent = city.Name;
          citySelect.appendChild(option);
        });
      }
    });

    // Form submission
    document.getElementById('accessForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const data = Object.fromEntries(formData.entries());

      // Parse time input
      const timeInput = data.time.split(':');
      data.hour = parseInt(timeInput[0]);
      data.minute = parseInt(timeInput[1]);
      data.second = parseInt(timeInput[2] || 0);
      data.millisecond = parseInt(data.millisecond);
      delete data.time;

      data.qr_enabled = data.qr_enabled === 'on';

      console.log("Submitting form data...");
      console.log('Form data:', data);


      // Disable the submit button
      const submitButton = document.getElementById('submit_button');
      submitButton.disabled = true;
      submitButton.textContent = 'Submitting...';

      // Send the data to your server
      fetch('/access', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          console.log('Success:', data);
          alert('Form submitted successfully!');
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred while submitting the form. Please try again.');
        })
        .finally(() => {
          // Re-enable the submit button
          submitButton.disabled = false;
          submitButton.textContent = 'Submit';
        });
    });
  </script>
</body>

</html>